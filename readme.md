<!--                          DO NOT EDIT THIS FILE                          -->

# `git_delete_stale_branches`

Safely delete your version controlled branches.

Main use case:

- I’m developing a feature on my `feat1` branch on computer A and computer B.

- I work alternating development on both computers.

- Once merged, one (or both) of the computers end up with stale, unused branches from that development (e.g. `feat1_a`, `feat1_b`, etc).

  `git_delete_stale_branches` allows one to safely remove these branches by comparing timestamps that are inserted into a version controlled file. If there’s a commit that comes after the insertion timestamp, that branch does not get deleted. If the last commit precedes the timestamp, the branch gets deleted. Since both machines share these list of branches to be deleted, you end up with a cleaner development process.

How to easily get Unix timestamp for vim users: `inoreabbrev nows <C-R>=strftime("%s")<CR>`.

## Man page

`✂ --------------------------------------------------`

% git_delete_stale_branches(1) % Felipe M. Vieira % August 2023

### NAME

git_delete_stale_branches – Safely delete your version controlled branches.

### SYNOPSIS

**git_delete_stale_branches** **–delete** **–git-directory** git_directory **–config-directory** config_directory

### DESCRIPTION

**git_delete_stale_branches** safely deletes your version controlled branches. It allows one to version control branches that are not necessary anymore and delete these checked out branches safely in another machine. Imagine that you are developing a branch on a machine A and on a machine B. What happens when you merge that branch or simply want to delete it? Will you remember which branches are ok to delete when you use machine B? Or what happens if you try to sync deleted branches from git when checked out on a branch that needs deletion? This is where **git_delete_stale_branches** steps in.

See how it is used here: <https://github.com/fmv1992/git_delete_stale_branches/blob/8b077a6370d282a789853ebc29a680465eb25e89/makefile#L150>.

#### Relevant files

- `official` file: a single line file containing the name of the main branch. This branch shall never be deleted.

  Example:

      main

  Example in Github: <https://github.com/fmv1992/git_delete_stale_branches/blob/main/other/git/branches/official#L1>.

- `deleted` file: a CSV with 3 fields: `timestamp_delete_if_commit_is_older,branch,timestamp_delete_after` where:

  - `timestamp_delete_if_commit_is_older`: a unix timestamp registering the time of the intention of deletion. If there’s a commit on `branch` that comes after this, it will not be deleted.

  - `branch`: the branch to be deleted.

  - `timestamp_delete_after`: a unix timestamp “scheduling” a time for deletion. Use zero (or leave empty) if you want it to be deleted right away. Use `date --date 'now + 7 days' '+%s'` for the deletion to happen only next week.

  For vim users, `nows <C-R>=strftime("%s")<CR>` and `inoreabbrev nextweek <C-R>=system("date --date 'now + 7 days + 10 seconds' '+%s'")[:-2]<CR>` might come in handy.

  Example:

      timestamp_delete_if_commit_is_older,branch,timestamp_delete_after
      1739817094,nojira_81,1741366313
      1739817095,feature_branch_1,1741366314
      1739817096,bugfix_123,1741366315

  Example in Github: <https://github.com/fmv1992/git_delete_stale_branches/blob/main/other/test/test_library/csv_valid_02.csv#L1>.

#### Recommended usage

One can create the necessary files like so:

    [[ -d ./.git ]] \
        && mkdir -p other/git/branches/ \
        && touch other/git/branches/{deleted,official}

### GENERAL OPTIONS

**-c**, **–config-directory**  
Specify the config directory. This directory must hold the `official` and `deletes` files.

**-g**, **–git-directory**  
Specify the git root directory that will have its branches deleted.

**-d**, **–delete**  
This flag is spurious but ensures that the user is aware that deletions will occur.

`-------------------------------------------------- ✂`

## Releasing

    cdp git_delete_stale_branches
    rm ./output/deb/*.deb
    make down build test release

<!--
&#10;## Developing
&#10;???
&#10;-->

### Testing

    cd /path/to/git_delete_stale_branches
    rm ./output/deb/*.deb
    make package down build test

## Notes

- `v0.1.x` requires a newer version of `gawk`, one that accepts `--csv` (`5.3.1` is certain to have it).

## TODO

- ̶A̶̶̶d̶̶̶d̶̶ ̶a̶̶ ̶3̶̶̶-̶̶̶f̶̶̶i̶̶̶e̶̶̶l̶̶̶d̶̶ ̶C̶̶̶S̶̶̶V̶̶ ̶v̶̶̶e̶̶̶r̶̶̶s̶̶̶i̶̶̶o̶̶̶n̶̶̶.̶̶

  - ̶U̶̶̶p̶̶̶d̶̶̶a̶̶̶t̶̶̶e̶̶ ̶d̶̶̶o̶̶̶c̶̶̶s̶̶̶.̶̶

- ̶S̶̶̶u̶̶̶p̶̶̶p̶̶̶o̶̶̶r̶̶̶t̶̶ ̶a̶̶ ̶2̶̶̶-̶̶̶f̶̶̶i̶̶̶e̶̶̶l̶̶̶d̶̶ ̶C̶̶̶S̶̶̶V̶̶ ̶v̶̶̶e̶̶̶r̶̶̶s̶̶̶i̶̶̶o̶̶̶n̶̶ ̶a̶̶̶n̶̶̶d̶̶ ̶3̶̶ ̶f̶̶̶i̶̶̶e̶̶̶l̶̶̶d̶̶ ̶o̶̶̶n̶̶̶e̶̶̶.̶̶

- Add a concrete usage for copy pasting…

- Remove the cluttering verbosity that prevents understanding of what is being done.

- `$HOME/backups/2024_08_23_17h_52m_56s_felipev_licitacoes_felipe_lucas_bugfix.tar.gz`:

  `git log --format=%at origin/nojira_2_get_more_data_local` → `git log --format=%at -- origin/nojira_2_get_more_data_local`

- Allow for deletion of remotes other than `origin`.

- Add packages definition. Ideally with a project that checks all the dependencies.

- Depends on [shell_argument_parsing_file](https://github.com/fmv1992/shell_argument_parsing_file "shell_argument_parsing_file"): add a `--help` and `--verbose` flags.

## Related projects

- [`fmv1992_cookiecutter_shell`](https://github.com/fmv1992/fmv1992_cookiecutter_shell): this repos uses `fmv1992_cookiecutter_shell`.

- [`shell_argument_parsing_file`](https://github.com/fmv1992/shell_argument_parsing_file): this repos uses `shell_argument_parsing_file`.

<!--  -->
<!-- https://pandoc.org/chunkedhtml-demo/8.16-links-1.html -->
<!--  ???: not working -->
<!-- # vim: set filetype=pandoc fileformat=unix nowrap spell spelllang=en: -->
<!--                          DO NOT EDIT THIS FILE                          -->
